<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>home.html</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="../static/assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../static/css/styles.css" rel="stylesheet" />

    <style>
        [v-cloak] {
            display: none;
        }
    </style>

</head>

<body>
    <div id="page-top" v-cloak>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <div class="navbar-brand">Vue - Django Web Programming</div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                    aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link" data-bs-target="#page-top" href="/#page-top">Home</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" data-bs-target="#portfolio" href="/#portfolio">Blog</a>
                        </li>
                        <li class="nav-item"><a class="nav-link" data-bs-target="#team" href="/#team">Iam</a></li>
                        <li class="nav-item"><a class="nav-link" href="/admin/">Admin</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-subheading">Welcome To My Blog !</div>
                <div style="margin-bottom: 250px;">저의 일상 생활과 개발 관련 사항을 기록하고 있습니다.</div>
            </div>
        </header>

        <!-- Blog Grid-->
        <section class="page-section bg-light" id="portfolio">
            <div class="container">
                <div class="text-center">
                    <div class="section-heading">
                        <span class="h2 text-uppercase">Post List</span>&nbsp;
                        <span v-if="category" class="h6 fst-italic">( Category: 카테고리 리스트 )</span>
                        <span v-if="tag" class="h6 fst-italic">( Tag: 태그 리스트 )</span>
                    </div>
                    <h3 class="section-subheading text-muted">Lorem ipsum dolor sit amet consectetur.</h3>
                </div>
                <div class="row">
                    <div v-for="post in postList" :key="post.id" class="col-lg-4 col-sm-6 mb-4">
                        <div class="portfolio-item">
                            <a class="portfolio-link" :href="`/blog/post/${post.id}/#post`">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content"><i class="fas fa-plus fa-3x"></i></div>
                                </div>
                                <img class="img-fluid my-img-h300" :src="" alt="..." />
                            </a>
                            <div class="portfolio-caption">
                                <div class="portfolio-caption-subheading text-muted">
                                    글 카테고리 &emsp;
                                    <i class="fas fa-heart text-danger"></i> 글 좋아요 갯수
                                </div>
                                <div class="portfolio-caption-heading my-post-title">글 제목</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Pagination -->
                <ul class="pagination justify-content-center">
                    <li :class="prevClass">
                        <div @click="firstPage" class="page-link">first</div>
                    </li>

                    <li :class="prevClass">
                        <div @click="prevPage" class="page-link">prev</div>
                    </li>

                    <li v-for="page in pages" :class="pageClass(page)">
                        <div @click="pageChanged(page)" class="page-link">현재페이지</div>
                    </li>

                    <li :class="nextClass">
                        <div @click="nextPage" class="page-link">next</div>
                    </li>

                    <li :class="nextClass">
                        <div @click="lastPage" class="page-link">last</div>
                    </li>
                </ul>

            </div>
        </section>

        <!-- Iam -->
        <section class="page-section bg-light" id="team">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">홍 길 동</h2>
                    <h3 class="section-subheading text-muted">Lorem ipsum dolor sit amet consectetur.</h3>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <div class="team-member">
                            <img class="mx-auto rounded-circle" src="{% static 'assets/img/team/3.jpg' %}" alt="..." />
                            <h4>Creative Company</h4>
                            <p class="text-muted">Python Web Programmer</p>
                            <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                            <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                            <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="mb-5">
                            <h4>파이썬 웹 프로그래밍 (기본편, 한빛미디어)</h4>
                            <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Minima maxime quam architecto quo inventore harum ex magni, dicta impedit.</p>
                        </div>
                        <div class="mb-5">
                            <h4>파이썬 웹 프로그래밍 (실전편, 한빛미디어)</h4>
                            <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Minima maxime quam architecto quo inventore harum ex magni, dicta impedit.</p>
                        </div>
                        <div class="mb-5">
                            <h4>Vue.js-Django 연동 웹 프로그래밍 (기본편, 인프런)</h4>
                            <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Minima maxime quam architecto quo inventore harum ex magni, dicta impedit.</p>
                        </div>
                        <div class="mb-5">
                            <h4>Vue.js-Django 연동 웹 프로그래밍 (실전편, 인프런)</h4>
                            <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Minima maxime quam architecto quo inventore harum ex magni, dicta impedit.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-4 text-lg-start">
                        Copyright &copy; Your Website 2023
                        <!-- This script automatically adds the current year to your website footer-->
                        <!-- (credit: https://updateyourfooter.com/)-->
                        <!-- <script>
                    document.write(new Date().getFullYear());
                </script> -->
                    </div>
                    <div class="col-lg-4 my-3 my-lg-0">
                        <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                        <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                        <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <a class="link-dark text-decoration-none me-3" href="#!">Privacy Policy</a>
                        <a class="link-dark text-decoration-none" href="#!">Terms of Use</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>


    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="../js/scripts.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        const PostListApp = {
            delimiters: ['[[', ']]'],

            data() {
                return {
                    postList: [],
                    category: '',
                    tag: '',
                    pageCnt: 1,
                    curPage: 1,
                    currentYear: new Date().getFullYear(),
                }
            },

            computed: {
                pages() {
                    console.log("pages()...");
                    let pages3 = [];
                    if (this.pageCnt === 1) pages3 = [1];
                    else if (this.pageCnt === 2) pages3 = [1, 2];
                    else if (this.pageCnt >= 3) {
                        if (this.curPage === 1) pages3 = [1, 2, 3];
                        else if (this.curPage === this.pageCnt) pages3 = [this.pageCnt - 2, this.pageCnt - 1, this.pageCnt];
                        else pages3 = [this.curPage - 1, this.curPage, this.curPage + 1];
                    }
                    return pages3
                },

                prevClass() {
                    console.log("prevClass()...");
                    if (this.curPage === 1) return 'page-item disabled';
                    else return 'page-item my-link';
                },

                nextClass() {
                    console.log("nextClass()...");
                    if (this.curPage === this.pageCnt) return 'page-item disabled';
                    else return 'page-item my-link';
                },

                // pageClass(page) {},
            },

            created() {
                console.log("created()...");
                const params = new URL(location).searchParams;
                this.category = params.get('category');
                this.tag = params.get('tag');
                this.fetchPostList();
            },

            methods: {
                fetchPostList(page = 1) {
                    console.log("fetchPostList()...", page, this.category, this.tag);
                    let getUrl = '';
                    if (this.category) getUrl = `/api/post/list/?page=${page}&category=${this.category}`;
                    else if (this.tag) getUrl = `/api/post/list/?page=${page}&tag=${this.tag}`;
                    else getUrl = `/api/post/list/?page=${page}`;

                    axios.get(getUrl)
                        .then(res => {
                            console.log("FETCH POSTLIST GET RES", res);
                            this.postList = res.data.postList;
                            this.pageCnt = res.data.pageCnt;
                            this.curPage = res.data.curPage;
                        })
                        .catch(err => {
                            console.log("FETCH POSTLIST GET ERR.RESPONSE", err.response);
                            alert(`${err.response.status} ${err.response.statusText}`);
                        });
                },

                pageChanged(page) {
                    console.log("pageChanged()...", page);
                    this.curPage = page;
                    this.fetchPostList(this.curPage);
                },

                prevPage() {
                    console.log("prevPage()...", this.curPage);
                    if (this.curPage <= 1) return;
                    else this.curPage = this.curPage - 1;
                    this.fetchPostList(this.curPage);
                },

                nextPage() {
                    console.log("nextPage()...", this.curPage);
                    if (this.curPage >= this.pageCnt) return;
                    else this.curPage = this.curPage + 1;
                    this.fetchPostList(this.curPage);
                },

                firstPage() {
                    console.log("firstPage()", this.curPage);
                    if (this.curPage <= 1) return;
                    else this.curPage = 1;
                    this.fetchPostList(this.curPage);
                },

                lastPage() {
                    console.log("lastPage()", this.curPage);
                    if (this.curPage >= this.pageCnt) return;
                    else this.curPage = this.pageCnt;
                    this.fetchPostList(this.curPage);
                },

                pageClass(page) {
                    console.log("pageClass()...", page);
                    if (this.curPage === page) return 'page-item my-link active';
                    else return 'page-item my-link';
                },
            },
        }

        Vue.createApp(PostListApp).mount('#page-top')
    </script>
</body>

</html>

<style>
    .my-img-h300 {
        width: 100%;
        height: 300px;
        object-fit: cover;
    }

    .my-post-title {
        height: 60px;
    }

    .my-link:hover {
        cursor: pointer;
    }
</style>