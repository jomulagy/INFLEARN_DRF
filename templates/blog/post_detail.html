<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>post_detail.html</title>

    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="../../static/assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../../static/css/styles.css" rel="stylesheet" />

    <style>
        [v-cloak] { display: none; }

        .my-img-h300 {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        .my-content {
            white-space: pre-wrap;
        }
        .my-link:hover {
            cursor: pointer;
            font-style: italic;
        }
        .my-comment-icon {
            font-size: 3em;
            color: darkgray;
        }
    </style>

</head>

<body>
    <div id="page-top" v-cloak>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <div class="navbar-brand">Vue - Django Web Programming</div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                    aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link" data-bs-target="#page-top"
                                href="/#page-top">Home</a></li>
                        <li class="nav-item"><a class="nav-link" data-bs-target="#portfolio"
                                href="/#portfolio">Blog</a></li>
                        <li class="nav-item"><a class="nav-link" data-bs-target="#team"
                                href="/#team">Iam</a></li>
                        <li class="nav-item"><a class="nav-link" href="/admin/">Admin</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-subheading">Welcome To My Blog !</div>
                <div style="margin-bottom: 250px;">저의 일상 생활과 개발 관련 사항을 기록하고 있습니다.</div>
            </div>
        </header>

        <!-- Post Detail Grid-->
<section class="page-section" id="post">
    <div class="container">
        <div class="row">
            <!-- Post title-->
            <h1 class="fw-bolder mb-1">글 제목</h1>
            <hr>
            <p>
                <span>글 수정시간</span> &emsp;

                <i class="fas fa-copyright"></i> &nbsp;
                <span class="text-success my-link" @click="serverPage(post.category, '')">글 카테고리</span> &emsp;
                
                <i class="fas fa-tag"></i> &nbsp;
                <span v-for="(tag, index) in post.tags" :key="index">
                    <span v-if="index !== 0">, </span>
                    <span class="text-success my-link" @click="serverPage('', tag)">글 해시태그</span>
                </span> &emsp;
                
                <i class="fas fa-heart"></i> &nbsp;
                <span class="text-success my-link" @click="likeCount(post.id)">좋아요갯수</span> &emsp;
            </p>
            <hr>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <!-- Post content-->
                <article>
                    <!-- Preview image figure-->
                    <figure class="mb-4"><img class="img-fluid rounded my-img-h300"
                            :src="" alt="..." /></figure>
                    <!-- Post content-->
                    <div class="mb-5">
                        <p class="fs-5 mb-4 my-content">글 내용</p>
                    </div>
                </article>
                <!-- Comments section-->
                <div class="mb-5">
                    <div class="card bg-light">
                        <div class="card-body">
                            <!-- Comment Form -->
                            <form id="comment-form" ref="commentForm" class="mb-4">
                                <textarea name="content" class="form-control" rows="3"
                                    placeholder="Join the discussion and leave a comment!"></textarea>
                                <div class="d-flex justify-content-end mt-1">
                                    <div @click="resetForm" class="btn btn-outline-secondary btn-sm me-2">RESET</div>
                                    <div @click="submitForm" class="btn btn-primary btn-sm">SUBMIT</div>
                                </div>
                            </form>
                            
                            <!-- Comment List -->
                            <div v-for="comment in commentList" :key="comment.id" class="d-flex mb-4">
                                <div class="flex-shrink-0 my-comment-icon">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">댓글 수정시간</div>
                                    <div class="my-content">댓글 내용</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Side widgets-->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">Prev Post</div>
                    <div class="card-body">
                        <h5 class="text-primary my-link" @click="fetchPostDetail(prevPost.id)">이전 글 제목</h5>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-header">Next Post</div>
                    <div class="card-body">
                        <h5 class="text-primary my-link" @click="fetchPostDetail(nextPost.id)">다음 글 제목</h5>
                    </div>
                </div>                
                <!-- Categories widget-->
                <div class="card mb-4">
                    <div class="card-header">Categories</div>
                    <div class="card-body">
                        <span v-for="(category, index) in cateList" :key="category.id">
                            <span v-if="index !== 0">&emsp;</span>
                            <span class="text-success my-link" @click="serverPage(category, '')">카테고리</span>
                        </span>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-header">Tag Cloud</div>
                    <div class="card-body">
                        <span v-for="(tag, index) in tagList" :key="tag.id">
                            <span v-if="index !== 0">&emsp;</span>
                            <span class="text-success my-link" @click="serverPage('', tag)">태그</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<footer class="footer py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-4 text-lg-start">
                Copyright &copy; Your Website 2023
                <!-- This script automatically adds the current year to your website footer-->
                <!-- (credit: https://updateyourfooter.com/)-->
                <!-- <script>
            document.write(new Date().getFullYear());
        </script> -->
            </div>
            <div class="col-lg-4 my-3 my-lg-0">
                <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-dark btn-social mx-2" href="#!"><i class="fab fa-linkedin-in"></i></a>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a class="link-dark text-decoration-none me-3" href="#!">Privacy Policy</a>
                <a class="link-dark text-decoration-none" href="#!">Terms of Use</a>
            </div>
        </div>
    </div>
</footer>
    </div>


    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="../../static/js/scripts.js"></script>


    <script src="https://unpkg.com/vue@next"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    axios.defaults.xsrfCookieName = 'csrftoken';
    axios.defaults.xsrfHeaderName = 'X-CSRFTOKEN';

    const PostDetailApp = {
        delimiters: ['[[', ']]'],

        data() {
            return {
                post: {},
                prevPost: {},
                nextPost: {},
                cateList: [],
                tagList: [],
                commentList: [],
            }
        },

        created() {
            console.log("created()...");
            const postId = location.pathname.split('/')[3];
            this.fetchPostDetail(postId);
            this.fetchCateTagList();
        },

        methods: {
            fetchPostDetail(postId) {
                console.log("fetchPostDetail()...", postId);

                axios.get(`/api/post/${postId}/`)
                    .then(res => {
                        console.log("FETCH POSTDETAIL GET RES", res);
                        this.post = res.data.post;
                        this.prevPost = res.data.prevPost;
                        this.nextPost = res.data.nextPost;
                        this.commentList = res.data.commentList;
                    })
                    .catch(err => {
                        console.log("FETCH POSTDETAIL GET ERR.RESPONSE", err.response);
                        alert(`${err.response.status} ${err.response.statusText}`);
                    });
            },

            fetchCateTagList() {
                console.log("fetchCateTagList()...");

                axios.get('/api/catetag/')
                    .then(res => {
                        console.log("FETCH CATE-TAG-LIST GET RES", res);
                        this.cateList = res.data.cateList;
                        this.tagList = res.data.tagList;
                    })
                    .catch(err => {
                        console.log("FETCH CATE-TAG-LIST GET ERR.RESPONSE", err.response);
                        alert(`${err.response.status} ${err.response.statusText}`);
                    });
            },

            serverPage(category = '', tag = '') {
                console.log("serverPage()...", category, tag);
                if (category && tag) alert(`serverPage() both args Error: ${category} and ${tag}`);
                else if (category) location.href = `/?category=${category}#portfolio`;
                else if (tag) location.href = `/?tag=${tag}#portfolio`;
                else location.href = '/#portfolio';
            },

            likeCount(postId) {
                console.log("likeCount()...", postId);
                axios.get(`/api/like/${postId}/`)
                    .then(res => {
                        console.log("LIKE-COUNT GET RES", res);
                        this.post.like = res.data;
                    })
                    .catch(err => {
                        console.log("LIKE-COUNT GET ERR.RESPONSE", err.response);
                        alert(`${err.response.status} ${err.response.statusText}`);
                    });
            },

            resetForm() {
                console.log("resetForm()...");
                this.$refs.commentForm.reset();
            },

            submitForm() {
                console.log("submitForm()...");
                let formdata = new FormData(document.getElementById('comment-form'));
                formdata.set('post', this.post.id);
                axios.post('/api/comment/create/', formdata)
                    .then(res => {
                        console.log("CREATE-COMMENT POST RES", res);
                        this.commentList.push(res.data);
                    })
                    .catch(err => {
                        console.log("CREATE-COMMENT GET ERR.RESPONSE", err.response);
                        alert(`${err.response.status} ${err.response.statusText}`);
                    });
                this.resetForm();
            },
        },
    }

    Vue.createApp(PostDetailApp).mount('#page-top')
</script>
</body>

</html>
